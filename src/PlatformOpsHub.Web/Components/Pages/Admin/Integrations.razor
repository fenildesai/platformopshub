@page "/admin/integrations"
@using Microsoft.AspNetCore.Authorization
@using PlatformOpsHub.Domain.Entities
@using PlatformOpsHub.Domain.Enums
@using PlatformOpsHub.Infrastructure.Data
@using Microsoft.EntityFrameworkCore
@attribute [Authorize(Roles = "Admin")]
@inject ApplicationDbContext Context

<PageTitle>Integrations - PlatformOps Hub</PageTitle>

<FluentTypography Typo="Typography.H2">Integrations</FluentTypography>
<FluentTypography Typo="Typography.Body">Configure external API connections and credentials.</FluentTypography>

<FluentGrid Style="margin-top: 20px;" Spacing="3">
    @foreach (var cred in credentials)
    {
        <FluentGridItem xs="12" sm="6" md="4">
            <FluentCard>
                <FluentStack Orientation="Orientation.Horizontal" VerticalAlignment="VerticalAlignment.Center">
                    <FluentIcon Value="@GetIntegrationIcon(cred.Type)" Color="Color.Accent" />
                    <FluentTypography Typo="Typography.H6">@cred.DisplayName</FluentTypography>
                    <FluentSpacer />
                    <FluentBadge Appearance="Appearance.Accent">
                        Connected
                    </FluentBadge>
                </FluentStack>
                
                <div style="margin-top: 15px;">
                    <FluentTypography Typo="Typography.Caption" Style="color: gray;">Last Updated: @cred.UpdatedAt.ToString("g")</FluentTypography>
                </div>
                
                <FluentStack Orientation="Orientation.Horizontal" Style="margin-top: 15px;">
                    <FluentButton IconStart="@(new Icons.Regular.Size16.Settings())" Appearance="Appearance.Stealth">Configure</FluentButton>
                    <FluentButton IconStart="@(new Icons.Regular.Size16.ArrowSync())" Appearance="Appearance.Stealth">Sync Now</FluentButton>
                </FluentStack>
            </FluentCard>
        </FluentGridItem>
    }
    
    <FluentGridItem xs="12" sm="6" md="4">
        <FluentCard Style="border: 2px dashed #ccc; display: flex; align-items: center; justify-content: center; cursor: pointer;">
            <FluentStack Orientation="Orientation.Vertical" HorizontalAlignment="HorizontalAlignment.Center">
                <FluentIcon Value="@(new Icons.Regular.Size24.Add())" Color="Color.Neutral" />
                <FluentTypography Typo="Typography.Body">Add Integration</FluentTypography>
            </FluentStack>
        </FluentCard>
    </FluentGridItem>
</FluentGrid>

@code {
    private List<IntegrationCredential> credentials = new();

    protected override async Task OnInitializedAsync()
    {
        credentials = await Context.IntegrationCredentials.ToListAsync();
    }

    private Icon GetIntegrationIcon(IntegrationType type) => type switch
    {
        IntegrationType.AzureDevOps => new Icons.Regular.Size24.Cloud(),
        IntegrationType.Jira => new Icons.Regular.Size24.TaskListLtr(),
        IntegrationType.SonarQube => new Icons.Regular.Size24.ShieldCheckmark(),
        IntegrationType.Checkmarx => new Icons.Regular.Size24.ShieldKeyhole(),
        _ => new Icons.Regular.Size24.Link()
    };
}
